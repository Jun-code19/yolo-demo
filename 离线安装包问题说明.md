# Linux安装脚本问题排查指南

## 🔍 问题诊断

错误 `cannot execute: required file not found` 通常由以下原因引起：

### 1. 检查文件是否存在
```bash
# 查看当前目录内容
ls -la

# 查看install.sh文件详细信息
ls -la install.sh
```

### 2. 检查文件权限
```bash
# 查看文件权限
ls -la install.sh

# 如果没有执行权限，添加执行权限
chmod +x install.sh
chmod +x manage.sh
```

### 3. 检查文件格式（换行符问题）
```bash
# 检查文件格式
file install.sh

# 如果显示"with CRLF line terminators"，需要转换格式
# 安装dos2unix工具
sudo apt-get update
sudo apt-get install dos2unix

# 转换文件格式
dos2unix install.sh
dos2unix manage.sh
```

### 4. 检查shebang行
```bash
# 查看文件开头
head -1 install.sh

# 应该显示: #!/bin/bash
# 检查bash是否存在
which bash
```

## 🛠️ 快速修复方案

### 方案一：重新创建install.sh脚本
```bash
# 备份原文件
mv install.sh install.sh.bak

# 创建新的install.sh
cat > install.sh << 'EOF'
#!/bin/bash

echo "=== YOLO Linux安装脚本 ==="
echo "系统架构: $(uname -m)"
echo ""

# 检查Docker
if ! command -v docker &> /dev/null; then
    echo "❌ Docker未安装"
    echo "Ubuntu/Debian安装命令:"
    echo "  curl -fsSL https://get.docker.com | sh"
    echo "  sudo usermod -aG docker $USER"
    echo "  newgrp docker"
    exit 1
fi
echo "✅ Docker已安装"

# 检查Docker Compose
if ! command -v docker-compose &> /dev/null; then
    echo "❌ Docker Compose未安装"
    echo "安装命令:"
    echo "  sudo curl -L \"https://github.com/docker/compose/releases/latest/download/docker-compose-Linux-x86_64\" -o /usr/local/bin/docker-compose"
    echo "  sudo chmod +x /usr/local/bin/docker-compose"
    exit 1  
fi
echo "✅ Docker Compose已安装"
echo ""

echo "🔄 加载Docker镜像..."
docker load < docker_images/data-server.tar
docker load < docker_images/detect-server.tar
docker load < docker_images/frontend.tar
docker load < docker_images/postgres.tar
echo "✅ 镜像加载完成"
echo ""

echo "📁 创建目录..."
mkdir -p models storage uploads
chmod 755 models storage uploads
echo "✅ 目录创建完成"
echo ""

echo "🚀 启动服务..."
docker-compose up -d
echo ""

echo "⏳ 等待服务启动..."
sleep 15
echo ""

echo "📊 检查服务状态..."
docker-compose ps
echo ""

echo "🎉 === 安装完成! ==="
echo "📱 前端访问: http://localhost"
echo "🔧 检测API: http://localhost:8000/docs"
echo "📊 数据API: http://localhost:8001/docs"
echo ""
echo "📋 常用命令:"
echo "  docker-compose ps        # 查看状态"
echo "  docker-compose logs -f   # 查看日志"
echo "  docker-compose down      # 停止服务"
echo "  docker-compose restart   # 重启服务"
EOF

# 设置执行权限
chmod +x install.sh
```

### 方案二：重新创建manage.sh脚本
```bash
# 创建管理脚本
cat > manage.sh << 'EOF'
#!/bin/bash

case "$1" in
  start)
    echo "🚀 启动YOLO服务..."
    docker-compose up -d
    ;;
  stop)
    echo "🛑 停止YOLO服务..."
    docker-compose down
    ;;
  restart)
    echo "🔄 重启YOLO服务..."
    docker-compose restart
    ;;
  status)
    echo "📊 服务状态:"
    docker-compose ps
    ;;
  logs)
    echo "📜 查看日志:"
    docker-compose logs -f
    ;;
  *)
    echo "YOLO Linux管理工具"
    echo "用法: $0 {start|stop|restart|status|logs}"
    ;;
esac
EOF

# 设置执行权限
chmod +x manage.sh
```

## 🚀 执行安装

### 1. 完成修复后执行安装
```bash
./install.sh
```

### 2. 如果仍有问题，手动执行安装步骤
```bash
# 1. 检查Docker环境
docker --version
docker-compose --version

# 2. 加载镜像
docker load < docker_images/data-server.tar
docker load < docker_images/detect-server.tar
docker load < docker_images/frontend.tar
docker load < docker_images/postgres.tar

# 3. 检查镜像是否加载成功
docker images

# 4. 创建目录
mkdir -p models storage uploads

# 5. 启动服务
docker-compose up -d

# 6. 查看状态
docker-compose ps
```

## 📋 常见错误及解决方案

| 错误信息 | 原因 | 解决方案 |
|---------|------|---------|
| `cannot execute: required file not found` | 文件格式或权限问题 | 按上述方案重新创建脚本 |
| `Permission denied` | 没有执行权限 | `chmod +x install.sh` |
| `command not found: docker` | Docker未安装 | 安装Docker |
| `command not found: docker-compose` | Docker Compose未安装 | 安装Docker Compose |
| `No such file or directory` | 文件路径错误 | 检查当前目录和文件位置 |

## 🔍 调试命令

```bash
# 查看文件详细信息
ls -la install.sh

# 查看文件内容
cat install.sh

# 查看文件格式
file install.sh

# 查看文件的十六进制开头（检查BOM等）
hexdump -C install.sh | head

# 检查bash解释器
which bash
echo $SHELL
```

## ✅ 验证安装

安装完成后，可以通过以下方式验证：

```bash
# 查看服务状态
docker-compose ps

# 查看日志
docker-compose logs

# 测试前端访问（如果有curl）
curl http://localhost

# 测试API访问
curl http://localhost:8000/docs
``` 